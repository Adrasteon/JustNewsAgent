[tool:pytest]
# Pytest configuration for JustNewsAgent testing framework

# Test discovery
testpaths = tests/refactor
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Enable live CLI logging
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)s] %(name)s: %(message)s
log_cli_date_format = %H:%M:%S

# Coverage configuration
addopts =
    --strict-markers
    --strict-config
    --runslow
    --cov=agents
    --cov=common
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-report=xml
    --cov-fail-under=80

# Custom markers
markers =
    # Test categories
    unit: Unit tests (fast, isolated)
    integration: Integration tests (may require services)
    e2e: End-to-end tests (full system)

    # Resource requirements
    gpu: Tests requiring CUDA-capable GPU
    slow: Tests that are slow/heavy (>5 seconds)
    database: Tests requiring database access

    # Test types
    security: Security-related tests
    performance: Performance benchmarking tests
    async: Async/await tests
    mock: Tests using extensive mocking

    # Component specific
    agent: Agent-specific tests
    mcp: MCP Bus communication tests
    ml: Machine learning model tests
    api: API endpoint tests

# AsyncIO configuration
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function
asyncio_default_test_loop_scope = function

# Filter warnings
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::UserWarning:transformers.*
    ignore::UserWarning:sentence_transformers.*

# Test execution
# maxfail = 5  # Stop after 5 failures
# tb = short   # Shorter tracebacks