# Logrotate configuration for JustNews services
# Install to: /etc/logrotate.d/justnews
#
# This configuration manages log rotation for all JustNews agent logs
# to prevent disk space exhaustion while maintaining adequate history.

/var/log/justnews/*.log {
    # Rotate daily
    daily
    
    # Keep 14 days of logs
    rotate 14
    
    # Compress rotated logs (except most recent)
    compress
    delaycompress
    
    # Don't error if log file is missing
    missingok
    
    # Don't rotate empty logs
    notifempty
    
    # Create new log files with appropriate permissions
    create 0644 justnews justnews
    
    # Use date extension instead of numbers
    dateext
    dateformat -%Y%m%d
    
    # Run postrotate script after rotation
    postrotate
        # Reload systemd services gracefully if running
        systemctl reload-or-restart 'justnews@*.service' 2>/dev/null || true
    endscript
    
    # Shared scripts - only run once for all logs
    sharedscripts
}

# Separate configuration for GPU orchestrator (may need longer retention)
/var/log/justnews/gpu_orchestrator*.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 0644 justnews justnews
    dateext
    dateformat -%Y%m%d
    postrotate
        systemctl reload-or-restart justnews@gpu_orchestrator.service 2>/dev/null || true
    endscript
    sharedscripts
}

# Separate configuration for error logs (keep longer)
/var/log/justnews/*-error.log {
    weekly
    rotate 8
    compress
    delaycompress
    missingok
    notifempty
    create 0644 justnews justnews
    dateext
    dateformat -%Y%m%d
    sharedscripts
}
