<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JustNews - AI-Powered News Analysis Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-bg: #0f172a;
            --card-bg: #1e293b;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
        }

        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            min-height: 100vh;
        }

        .navbar {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
            background: linear-gradient(45deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-link {
            color: var(--text-secondary) !important;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-link:hover, .nav-link.active {
            color: var(--text-primary) !important;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 8px;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            background: rgba(30, 41, 59, 0.8);
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
            color: var(--text-primary);
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(45deg, #3b82f6, #6366f1);
            border: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .article-card {
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .article-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
        }

        .article-title {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .article-meta {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .sentiment-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .sentiment-positive { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .sentiment-negative { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .sentiment-neutral { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }

        .metric-card {
            text-align: center;
            padding: 1.5rem;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .metric-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 0.5rem;
        }

        .status-online { background: var(--success-color); }
        .status-offline { background: var(--danger-color); }
        .status-warning { background: var(--warning-color); }

        .search-input {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 8px;
            color: var(--text-primary);
            padding: 0.75rem 1rem;
        }

        .search-input:focus {
            background: rgba(30, 41, 59, 0.9);
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .hero-section {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
            border-radius: 16px;
            padding: 3rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .hero-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #3b82f6, #8b5cf6, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero-subtitle {
            font-size: 1.125rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        .tab-content {
            padding: 2rem 0;
        }

        .agent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .agent-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .agent-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .agent-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .agent-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .agent-status {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        @media (max-width: 768px) {
            .hero-title { font-size: 2rem; }
            .agent-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-newspaper me-2"></i>JustNews
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#news" data-bs-toggle="tab">
                            <i class="fas fa-home me-1"></i>News Feed
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#agents" data-bs-toggle="tab">
                            <i class="fas fa-robot me-1"></i>AI Agents
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#analytics" data-bs-toggle="tab">
                            <i class="fas fa-chart-line me-1"></i>Analytics
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#training" data-bs-toggle="tab">
                            <i class="fas fa-brain me-1"></i>Training
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#crawl" data-bs-toggle="tab">
                            <i class="fas fa-search me-1"></i>Crawler
                        </a>
                    </li>
                </ul>
                <div class="d-flex">
                    <input type="text" class="form-control search-input me-2" placeholder="Search articles..." id="searchInput">
                    <button class="btn btn-primary" id="searchBtn">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <!-- Hero Section -->
        <div class="hero-section">
            <h1 class="hero-title">Welcome to JustNews</h1>
            <p class="hero-subtitle">AI-powered news analysis platform with real-time sentiment analysis, fact-checking, and intelligent synthesis</p>
            <div class="row mt-4">
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="totalArticles">0</div>
                        <div class="metric-label">Articles Analyzed</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="activeAgents">0</div>
                        <div class="metric-label">Active Agents</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="processingSpeed">0</div>
                        <div class="metric-label">Articles/sec</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-value" id="accuracyScore">0%</div>
                        <div class="metric-label">Analysis Accuracy</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Content -->
        <div class="tab-content">
            <!-- News Feed Tab -->
            <div class="tab-pane fade show active" id="news" role="tabpanel">
                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-newspaper me-2"></i>Latest News
                                </h5>
                            </div>
                            <div class="card-body">
                                <div id="newsFeed" class="row">
                                    <!-- Articles will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h6 class="card-title mb-0">Sentiment Overview</h6>
                            </div>
                            <div class="card-body">
                                <canvas id="sentimentChart"></canvas>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h6 class="card-title mb-0">Top Topics</h6>
                            </div>
                            <div class="card-body">
                                <div id="topTopics">
                                    <!-- Topics will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Agents Tab -->
            <div class="tab-pane fade" id="agents" role="tabpanel">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-robot me-2"></i>AI Agent Status
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="agent-grid" id="agentGrid">
                            <!-- Agent cards will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div class="tab-pane fade" id="analytics" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="card-title mb-0">System Performance</h6>
                            </div>
                            <div class="card-body">
                                <canvas id="performanceChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="card-title mb-0">GPU Utilization</h6>
                            </div>
                            <div class="card-body">
                                <canvas id="gpuChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="card-title mb-0">Agent Activity Timeline</h6>
                            </div>
                            <div class="card-body">
                                <canvas id="activityChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Training Tab -->
            <div class="tab-pane fade" id="training" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-brain me-2"></i>Training Status
                                </h5>
                            </div>
                            <div class="card-body">
                                <div id="trainingStatus">
                                    <!-- Training status will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-chart-line me-2"></i>Model Performance
                                </h5>
                            </div>
                            <div class="card-body">
                                <canvas id="trainingChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Crawler Tab (existing functionality) -->
            <div class="tab-pane fade" id="crawl" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Crawl Configuration</h5>
                            </div>
                            <div class="card-body">
                                <form id="crawlForm">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label for="domains" class="form-label">Domains or Database Query</label>
                                            <input type="text" class="form-control" id="domains" placeholder="e.g., bbc.com, cnn.com or 'sources 10' or 'all'" value="sources 5">
                                            <div class="form-text" style="color: #a0aec0;">Use comma-separated domains, 'sources &lt;number&gt;' for database sources, or 'all' for all sources</div>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="maxSites" class="form-label">Max Sites</label>
                                            <input type="number" class="form-control" id="maxSites" value="5" min="1" max="50">
                                        </div>
                                        <div class="col-md-3">
                                            <label for="maxArticlesPerSite" class="form-label">Max Articles per Site</label>
                                            <input type="number" class="form-control" id="maxArticlesPerSite" value="10" min="1" max="100">
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-md-4">
                                            <label for="concurrentSites" class="form-label">Concurrent Sites</label>
                                            <input type="number" class="form-control" id="concurrentSites" value="3" min="1" max="10">
                                        </div>
                                        <div class="col-md-4">
                                            <label for="strategy" class="form-label">Crawl Type</label>
                                            <select class="form-select" id="strategy">
                                                <option value="auto">Auto (Recommended)</option>
                                                <option value="ultra_fast">Ultra Fast (8.14+ art/sec)</option>
                                                <option value="ai_enhanced">AI Enhanced (0.86+ art/sec)</option>
                                                <option value="generic">Generic (Universal)</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label for="enableAI" class="form-label">Enable AI Analysis</label>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="enableAI" checked>
                                                <label class="form-check-label" for="enableAI">
                                                    Apply AI analysis to articles
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-md-6">
                                            <label for="timeout" class="form-label">Timeout (seconds)</label>
                                            <input type="number" class="form-control" id="timeout" value="300" min="30" max="3600">
                                        </div>
                                        <div class="col-md-6">
                                            <label for="userAgent" class="form-label">User Agent</label>
                                            <input type="text" class="form-control" id="userAgent" value="JustNewsAgent/1.0">
                                        </div>
                                    </div>
                                    <button type="button" id="crawlButton" class="btn btn-primary mt-3">Start Crawl</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Crawl Status</h5>
                            </div>
                            <div class="card-body" style="height: 600px; overflow-y: auto;">
                                <div id="crawlStatus">No active crawl</div>
                                <div class="mt-2">
                                    <button id="refreshStatus" class="btn btn-secondary btn-sm me-2">Refresh</button>
                                    <button id="clearStatus" class="btn btn-outline-secondary btn-sm me-2">Clear Status</button>
                                    <button id="resetCrawler" class="btn btn-outline-danger btn-sm">Reset Crawler</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let isCrawling = false;

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
            setupEventListeners();
            // Auto-refresh every 30 seconds
            setInterval(loadDashboardData, 30000);
        });

        function setupEventListeners() {
            // Search functionality
            document.getElementById('searchBtn').addEventListener('click', performSearch);
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') performSearch();
            });

            // Crawler controls (existing functionality)
            document.getElementById('crawlButton').addEventListener('click', function() {
                if (isCrawling) {
                    stopCrawl();
                } else {
                    startCrawl();
                }
            });

            document.getElementById('refreshStatus').addEventListener('click', refreshCrawlStatus);
            document.getElementById('clearStatus').addEventListener('click', clearCrawlStatus);
            document.getElementById('resetCrawler').addEventListener('click', resetCrawler);
        }

        async function loadDashboardData() {
            try {
                // Load system overview
                await loadSystemOverview();

                // Load news feed
                await loadNewsFeed();

                // Load agent status
                await loadAgentStatus();

                // Load analytics
                await loadAnalytics();

                // Load training status
                await loadTrainingStatus();

            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        async function loadSystemOverview() {
            try {
                // Get system health
                const healthResponse = await fetch('/api/health');
                const health = await healthResponse.json();

                // Get metrics
                const [crawlerMetrics, analystMetrics, memoryMetrics] = await Promise.all([
                    fetch('/api/metrics/crawler').then(r => r.json()).catch(() => ({articles_processed: 0})),
                    fetch('/api/metrics/analyst').then(r => r.json()).catch(() => ({sentiment_count: 0})),
                    fetch('/api/metrics/memory').then(r => r.json()).catch(() => ({used: 0}))
                ]);

                // Update metrics
                document.getElementById('totalArticles').textContent = crawlerMetrics.articles_processed || 0;
                document.getElementById('activeAgents').textContent = Object.values(health).filter(h => h).length;
                document.getElementById('processingSpeed').textContent = crawlerMetrics.articles_per_second || 0;
                document.getElementById('accuracyScore').textContent = '95%'; // Placeholder

            } catch (error) {
                console.error('Error loading system overview:', error);
            }
        }

        async function loadNewsFeed() {
            try {
                // Get recent articles from memory agent
                const response = await fetch('/send_command', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        args: [10],
                        kwargs: {}
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    displayNewsFeed(data.articles || []);
                }
            } catch (error) {
                console.error('Error loading news feed:', error);
                document.getElementById('newsFeed').innerHTML = '<p class="text-muted">Unable to load news feed</p>';
            }
        }

        function displayNewsFeed(articles) {
            const newsFeed = document.getElementById('newsFeed');

            if (!articles || articles.length === 0) {
                newsFeed.innerHTML = '<p class="text-muted">No articles available</p>';
                return;
            }

            const articlesHtml = articles.map(article => `
                <div class="col-md-6 mb-4">
                    <div class="article-card card h-100">
                        <div class="card-body">
                            <h6 class="article-title">${article.title || 'Untitled Article'}</h6>
                            <p class="article-meta">
                                <i class="fas fa-globe me-1"></i>${article.source || 'Unknown Source'} â€¢
                                <i class="fas fa-clock me-1"></i>${formatDate(article.published_date)}
                            </p>
                            <div class="mb-2">
                                <span class="sentiment-badge sentiment-${getSentimentClass(article.sentiment_score || 0)}">
                                    ${getSentimentLabel(article.sentiment_score || 0)}
                                </span>
                            </div>
                            <p class="text-muted small">${(article.content || '').substring(0, 150)}...</p>
                        </div>
                    </div>
                </div>
            `).join('');

            newsFeed.innerHTML = articlesHtml;
        }

        async function loadAgentStatus() {
            try {
                const response = await fetch('/get_status');
                const agents = await response.json();

                const agentGrid = document.getElementById('agentGrid');
                const agentCards = [
                    { name: 'Scout', port: 8002, icon: 'fas fa-search', description: 'Content Discovery' },
                    { name: 'Analyst', port: 8004, icon: 'fas fa-chart-bar', description: 'Sentiment Analysis' },
                    { name: 'Fact Checker', port: 8003, icon: 'fas fa-check-circle', description: 'Verification' },
                    { name: 'Synthesizer', port: 8005, icon: 'fas fa-brain', description: 'Content Synthesis' },
                    { name: 'Critic', port: 8006, icon: 'fas fa-star', description: 'Quality Assessment' },
                    { name: 'Chief Editor', port: 8001, icon: 'fas fa-user-tie', description: 'Workflow Orchestration' },
                    { name: 'Memory', port: 8007, icon: 'fas fa-database', description: 'Data Storage' },
                    { name: 'Reasoning', port: 8008, icon: 'fas fa-cogs', description: 'Logical Analysis' }
                ];

                const cardsHtml = agentCards.map(agent => {
                    const isActive = agents[agent.name.toLowerCase()]?.status === 'active';
                    return `
                        <div class="agent-card">
                            <div class="${agent.icon} agent-icon"></div>
                            <div class="agent-name">${agent.name}</div>
                            <div class="agent-status">
                                <span class="status-indicator ${isActive ? 'status-online' : 'status-offline'}"></span>
                                ${isActive ? 'Online' : 'Offline'}
                            </div>
                            <div class="text-muted small mt-2">${agent.description}</div>
                        </div>
                    `;
                }).join('');

                agentGrid.innerHTML = cardsHtml;

            } catch (error) {
                console.error('Error loading agent status:', error);
            }
        }

        async function loadAnalytics() {
            try {
                // Load GPU data
                const gpuResponse = await fetch('/gpu/dashboard');
                const gpuData = await gpuResponse.json();

                if (gpuData.status === 'success') {
                    updateGPUChart(gpuData);
                }

                // Load performance data
                const perfResponse = await fetch('/api/metrics/crawler');
                const perfData = await perfResponse.json();

                updatePerformanceChart(perfData);

            } catch (error) {
                console.error('Error loading analytics:', error);
            }
        }

        async function loadTrainingStatus() {
            try {
                const response = await fetch('/send_command', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        args: [],
                        kwargs: {}
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('trainingStatus').innerHTML = `
                        <div class="alert alert-info">
                            <h6>Training Coordinator Status</h6>
                            <p>Status: ${data.status || 'Unknown'}</p>
                            <p>Active Sessions: ${data.active_sessions || 0}</p>
                            <p>Last Update: ${new Date().toLocaleString()}</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading training status:', error);
                document.getElementById('trainingStatus').innerHTML = '<p class="text-muted">Unable to load training status</p>';
            }
        }

        function updateGPUChart(data) {
            const ctx = document.getElementById('gpuChart').getContext('2d');
            const gpu = data.gpu_info.gpus?.[0] || {};

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Used', 'Free'],
                    datasets: [{
                        data: [gpu.memory_used_mb || 0, gpu.memory_free_mb || 0],
                        backgroundColor: ['#ef4444', '#10b981'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: { color: '#f8fafc' }
                        }
                    }
                }
            });
        }

        function updatePerformanceChart(data) {
            const ctx = document.getElementById('performanceChart').getContext('2d');

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['1m', '5m', '15m', '1h', '6h', '24h'],
                    datasets: [{
                        label: 'Articles/sec',
                        data: [data.articles_per_second || 0, 2.1, 1.8, 1.5, 1.2, 0.9],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 206, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: { ticks: { color: '#cbd5e1' }, grid: { color: '#374151' } },
                        y: { ticks: { color: '#cbd5e1' }, grid: { color: '#374151' } }
                    },
                    plugins: {
                        legend: { labels: { color: '#f8fafc' } }
                    }
                }
            });
        }

        function performSearch() {
            const query = document.getElementById('searchInput').value.trim();
            if (query) {
                // Implement search functionality
                console.log('Searching for:', query);
                // TODO: Implement actual search
            }
        }

        // Utility functions
        function formatDate(dateString) {
            if (!dateString) return 'Unknown';
            try {
                return new Date(dateString).toLocaleDateString();
            } catch {
                return 'Unknown';
            }
        }

        function getSentimentClass(score) {
            if (score > 0.1) return 'positive';
            if (score < -0.1) return 'negative';
            return 'neutral';
        }

        function getSentimentLabel(score) {
            if (score > 0.1) return 'Positive';
            if (score < -0.1) return 'Negative';
            return 'Neutral';
        }

        // Crawler functions (existing functionality)
        function updateButtonState() {
            const button = document.getElementById('crawlButton');
            if (isCrawling) {
                button.textContent = 'Stop Crawl';
                button.className = 'btn btn-danger mt-3';
            } else {
                button.textContent = 'Start Crawl';
                button.className = 'btn btn-primary mt-3';
            }
        }

        function checkCrawlStatus() {
            fetch('/api/crawl/status')
            .then(response => response.json())
            .then(data => {
                const hasActiveJobs = Object.values(data).some(job =>
                    job.status === 'running' || job.status === 'pending'
                );

                if (isCrawling && !hasActiveJobs) {
                    isCrawling = false;
                    updateButtonState();
                } else if (!isCrawling && hasActiveJobs) {
                    isCrawling = true;
                    updateButtonState();
                }
            })
            .catch(error => {
                console.error('Error checking crawl status:', error);
            });
        }

        function startCrawl() {
            document.getElementById('crawlStatus').innerHTML = '<div style="color: #38a169; font-weight: bold;">Initializing crawl...</div>';

            const formData = {
                domains: document.getElementById('domains').value,
                max_sites: parseInt(document.getElementById('maxSites').value),
                max_articles_per_site: parseInt(document.getElementById('maxArticlesPerSite').value),
                concurrent_sites: parseInt(document.getElementById('concurrentSites').value),
                strategy: document.getElementById('strategy').value,
                enable_ai: document.getElementById('enableAI').checked,
                timeout: parseInt(document.getElementById('timeout').value),
                user_agent: document.getElementById('userAgent').value
            };

            fetch('/api/crawl/start', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('crawlStatus').innerHTML = `<div style="color: #38a169; font-weight: bold;">Crawl started successfully!</div><div style="color: #ffffff; margin-top: 10px;">Job ID: ${data.job_id || 'Unknown'}</div>`;
                setTimeout(checkCrawlStatus, 1000);
            })
            .catch(error => {
                document.getElementById('crawlStatus').innerHTML = `<div style="color: #e53e3e; font-weight: bold;">Error starting crawl:</div><div style="color: #ffffff; margin-top: 10px;">${error.message}</div>`;
            });
        }

        function stopCrawl() {
            fetch('/api/crawl/stop', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('crawlStatus').innerHTML = `<div style="color: #38a169; font-weight: bold;">Crawl stopped successfully!</div><div style="color: #ffffff; margin-top: 10px;">${data.message}</div>`;
                setTimeout(checkCrawlStatus, 1000);
            })
            .catch(error => {
                document.getElementById('crawlStatus').innerHTML = `<div style="color: #e53e3e; font-weight: bold;">Error stopping crawl:</div><div style="color: #ffffff; margin-top: 10px;">${error.message}</div>`;
            });
        }

        function refreshCrawlStatus() {
            fetch('/api/crawl/status')
            .then(response => response.json())
            .then(data => {
                document.getElementById('crawlStatus').innerHTML = `<pre style="color: #ffffff; background-color: #2d3748; padding: 10px; border-radius: 5px;">${JSON.stringify(data, null, 2)}</pre>`;
                checkCrawlStatus();
            })
            .catch(error => {
                document.getElementById('crawlStatus').innerHTML = `<div style="color: #e53e3e; font-weight: bold;">Error refreshing status:</div><div style="color: #ffffff; margin-top: 10px;">${error.message}</div>`;
            });
        }

        function clearCrawlStatus() {
            fetch('/api/crawl/clear_jobs', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                console.log('Cleared jobs:', data);
            })
            .catch(error => {
                console.error('Error clearing jobs:', error);
            })
            .finally(() => {
                document.getElementById('crawlStatus').innerHTML = '<div style="color: #ffffff;">Status cleared</div>';
            });
        }

        function resetCrawler() {
            if (confirm('This will completely reset the crawler state, clearing all jobs and metrics. Continue?')) {
                fetch('/api/crawl/reset', {
                    method: 'POST'
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Reset crawler:', data);
                    document.getElementById('crawlStatus').innerHTML = '<div style="color: #38a169; font-weight: bold;">Crawler reset successfully</div>';
                    isCrawling = false;
                    updateButtonState();
                })
                .catch(error => {
                    console.error('Error resetting crawler:', error);
                    document.getElementById('crawlStatus').innerHTML = `<div style="color: #e53e3e; font-weight: bold;">Error resetting crawler:</div><div style="color: #ffffff; margin-top: 10px;">${error.message}</div>`;
                });
            }
        }

        // Initialize crawler status checking
        setInterval(checkCrawlStatus, 30000);
        checkCrawlStatus();
    </script>
</body>
</html>